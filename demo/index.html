<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1">
  <title>cache.adderall() - the impatient version of cache.addAll()</title>
  <meta name="description" content="Speed up caching in your Service Workers with a drop-in replacement for cache.addAll()" />
  <meta property="og:image" content="https://www.talater.com/cache.adderall/img/adderall-screenshot.jpg"/>
  <meta property="og:title" content="cache.adderall() - the impatient version of cache.addAll()"/>
  <meta property="og:description" content="Speed up caching in your Service Workers with a drop-in replacement for cache.addAll()"/>
  <meta property="og:url" content="https://www.talater.com/cache.adderall/"/>
  <meta property="og:site_name" content="cache.adderall()"/>
  <meta property="fb:admins" content="568390229" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="styles/main.css">
  <link href='//fonts.googleapis.com/css?family=Lato:300,700,900' rel='stylesheet' type='text/css'>
</head>
<body>
  <header class="container-fluid">
    <div class="container-fluid">
      <h1 class="center-block">cache.<strong>adderall</strong>()</h1>
      <h2 class="center-block">the impatient version of cache.addAll()</h2>
      <h3 class="center-block">Speed up your <strong>Service Workers</strong> and save bandwidth with a drop-in replacement for cache.addAll()</h3>
    </div>
  </header>
  <div class="show-and-tell">
    <video class="img-responsive center-block" onplaying="this.controls=false;" onclick="this.play();" src="video/cache.adderall_demo.mp4" poster="img/cache.adderall_demo.png"></video>
  </div>
  <div class="container narrower">
    <div class="row" id="text-comparison">
      <div class="col-sm-5 col-sm-offset-1">
        <p><code>cache.addAll()</code> receives a list of URLs, and fetches each of them from the network.</p>
        <p>It returns a promise that only resolves if all the URLs were added to the cache successfully.</p>
      </div>
      <div class="col-sm-5">
        <p><code>cache.adderall()</code> receives a list of URLs, <strong>then the lazy bastard looks for them in existing caches, only fetching them from the network if it has to.</strong></p>
        <p>It returns a promise that only resolves if all the URLs were added to the cache successfully.</p>
      </div>
    </div>
  </div>
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h3>What does <code>cache.adderall()</code> do?</h3>
        <p>When we install a new service worker, it is common practice to use <code>cache.addAll()</code> to cache all the URLs our web app needs. Then, when we make any change to the service worker, or change the list of files it needs to cache, the install event runs again and fetches every single file again… This can be terribly inefficient and wasteful.</p>
        <p><code>cache.adderall()</code> is very much like the browser's native <code>cache.addAll()</code>. The only difference is that when you call it, <code>cache.adderall()</code> first looks for the files you are trying to cache in the user's existing caches. If any of these files are found, they will be copied over to the new cache, so that your service worker only needs to download new files. Any file that isn't already cached will be fetched as usual using the native <code>cache.addAll()</code>.</p>
        <p>This saves bandwidth, speeds up your service worker installation, and saves your users from downloading the same files over and over again, every time your service worker changes.</p>
        <h3>Using <code>cache.adderall()</code></h3>
        <p>Once you've imported <code>cache.adderall()</code> into your service worker, calling <code>cache.adderall()</code> is very much like calling <code>cache.addAll()</code>. The only difference is that instead of calling <code>addAll()</code> on a cache object and passing it an array of URLs, you call <code>adderall.addAll()</code> passing it the cache object followed by the array of URLs.</p>
        <div id="code-basic">
<pre id="code-basic-adderall"><code class="javascript">// In your service worker
importScripts('js/cache.adderall.js');

var STATIC_FILES = [
  'video/cache.adderall.demo.mp4',
  '/bootstrap/3.3.7/css/bootstrap.min.css',
  '/js/2.6.0/annyang.min.js'
];

self.addEventListener('install', event => {
  event.waitUntil(
    caches.open('cache-v1').then(cache =>
      adderall.addAll(cache, STATIC_FILES)
    )
  );
});</code></pre>
<pre id="code-basic-addall"><code class="javascript">// In your service worker


var STATIC_FILES = [
  'video/cache.adderall.demo.mp4',
  '/bootstrap/3.3.7/css/bootstrap.min.css',
  '/js/2.6.0/annyang.min.js'
];

self.addEventListener('install', event => {
  event.waitUntil(
    caches.open('cache-v1').then(cache =>
      cache.addAll(STATIC_FILES)
    )
  );
});</code></pre>
        </div>
        <p>When the service worker above first runs in your user's service worker, it will behave exactly like <code>cache.addAll()</code>. But let's say you then decide to add a 4th file to the <code>STATIC_FILES</code> array, this is where <code>cache.adderall()</code> shines. Where <code>cache.addAll()</code> would download every file again, <code>adderall.addAll()</code> only downloads the new file, and copies existing files from the old cache to the new (or just leaves them where they are, if both versions use the same cache).</p>
        <h3>Wait a second… what if my files changed?</h3>
        <p><code>cache.adderall()</code>'s lazy approach is great for files that never change (e.g. <code>style.v38.css</code>, or<code>/js/2.6.0/annyang.min.js</code>). But if some of your files may change between versions, while their URL stays the same (e.g. <code>index.html</code>, <code>app-settings.json</code>), you can ask <code>cache.adderall()</code> to skip its lazy behavior for those files.</p>
        <p>Any file that needs to be fetched from the network every time you update your service worker can be passed in a second array of URLs as <code>cache.adderall()</code>'s third argument.</p>
        <pre><code class="javascript">// In your service worker
importScripts('js/cache.adderall.js');

var STATIC_FILES = [
  'video/cache.adderall.demo.mp4',
  '/bootstrap/3.3.7/css/bootstrap.min.css',
  '/js/2.6.0/annyang.min.js'
];

var MUTABLE_FILES = [
  'app-settings.json',
  'index.html'
];

self.addEventListener('install', event => {
  event.waitUntil(
    caches.open('cache-v2').then(cache =>
      adderall.addAll(cache, STATIC_FILES, MUTABLE_FILES)
    )
  );
});</code></pre>
        <p>Any URLs passed in the 3rd argument, are handled directly by the native <code>cache.addAll()</code>.</p>
        <p>In fact, the following two commands do exactly the same thing:</p>
        <pre><code class="javascript">cache.addAll(['/index.html', '/main.css']);
adderall.addAll(cache, undefined, ['/index.html', '/main.css']);
</code></pre>
        <p>Remember: <code>adderall.addAll(cache, immutableURLs, mutableURLs);</code></p>
        <h3>What about HTTP caching?</h3>
        <p>If your server is configured to serve each different file with the correct caching headers, serving mutable content with a <code>Cache-Control: no-cache</code> header, and immutable content with <code>Cache-Control: max-age=31536000</code>, then you might not need <code>cache.adderall()</code> at all. In fact, this is the prefered approach. You can read more details on <a href="https://jakearchibald.com/2016/caching-best-practices/">caching header best practices</a> in Jake Archibald's excellent post.</p>
        <p>If however, you are in an environment where you can't control the caching headers of individual files, can't access the server, are not speaking with Dev Ops over a relatively minor hunting accident, or you are just using GitHub Pages - give <code>cache.adderall()</code> a try.</p>
        <p>Thanks <a href="https://twitter.com/jaffathecake">Jake Archibald</a> and <a href="https://twitter.com/jeffposnick">Jeffrey Posnick</a> for helping sort this out.</p>
      </div>
    </div>
  </div>
<script>
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('sw.js');
  }
</script>
<!-- Unrelated sugar to make the page look nice -->
<script src="js/main.js"></script>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/atelier-heath-light.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
